local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local FOV = Drawing.new("Circle")
FOV.Visible = true
FOV.Thickness = 1
FOV.Radius = 150
FOV.Color = Color3.fromRGB(255, 255, 255)
FOV.Filled = false

local function getTarget()
    local closest, dist = nil, FOV.Radius
    local center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team then
            local char = p.Character
            if char and char:FindFirstChild("Head") and char.Humanoid.Health > 0 then
                local pos, onScreen = Camera:WorldToViewportPoint(char.Head.Position)
                if onScreen then
                    local magnitude = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                    if magnitude < dist then
                        closest = char.Head
                        dist = magnitude
                    end
                end
            end
        end
    end
    return closest
end

local mt = getrawmetatable(game)
local old = mt.__namecall
setreadonly(mt, false)

mt.__namecall = function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    if method == "FireServer" and tostring(self) == "Fire" then
        local t = getTarget()
        if t then
            return old(self, t.Position, unpack(args))
        end
    end
    return old(self, unpack(args))
end

setreadonly(mt, true)

RunService.RenderStepped:Connect(function()
    FOV.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end)
